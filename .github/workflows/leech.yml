name: Syzo Leech Worker
on:
  repository_dispatch:
    types: [start-leech]

jobs:
  leech-job:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Telegram (Process Start)
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELE_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELE_ID }}&text=âš¡ *Worker Started!*%0A sedang men-download dari SourceForge...&parse_mode=Markdown"

      - name: Download File from SourceForge
        run: |
          sudo apt-get install -y aria2
          # Mengambil URL dari kiriman Vercel
          URL="${{ github.event.client_payload.url }}"
          aria2c -x 16 -s 16 -j 16 -k 1M "$URL" -o "leech_file"

      - name: Upload to GoFile
        id: upload
        run: |
          # Cari server GoFile yang tersedia
          SERVER=$(curl -s https://api.gofile.io/getServer | jq -r '.data.server')
          # Upload file
          RESPONSE=$(curl -F "file=@leech_file" "https://${SERVER}.gofile.io/uploadFile")
          DOWNLOAD_LINK=$(echo $RESPONSE | jq -r '.data.downloadPage')
          echo "FINAL_LINK=$DOWNLOAD_LINK" >> $GITHUB_ENV

      - name: Notify Telegram (Finished)
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELE_TOKEN }}/sendMessage" \
          -d "chat_id=${{ secrets.TELE_ID }}&text=âœ… *Leech Berhasil!*%0A%0AðŸ”— Link Download: ${{ env.FINAL_LINK }}&parse_mode=Markdown"
